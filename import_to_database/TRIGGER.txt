CREATE FUNCTION TF_GENERATE_ITEMCODE() RETURNS trigger AS $TF_GENERATE_ITEMCODE$
	DECLARE
		LOC_CODE varchar(1) := '1';
		CAT_CODE varchar(3);
		ID_CODE varchar(6);
		COL_CODE varchar(3);
    BEGIN
        SELECT LPAD(NEW.category_id::varchar(10),3,'0') INTO CAT_CODE;
		SELECT LPAD(NEW.item_id::varchar(10),6,'0') INTO ID_CODE;
		SELECT LPAD(NEW.color_id::varchar(10),3,'0') INTO COL_CODE;

		NEW.item_code := LOC_CODE || CAT_CODE || ID_CODE || COL_CODE;
		NEW.barcode_str := NEW.item_code;
		RETURN NEW;
    END;
$TF_GENERATE_ITEMCODE$ LANGUAGE plpgsql;

CREATE TRIGGER TGBIU_GENERATE_ITEMCODE BEFORE INSERT OR UPDATE ON tbitem
    FOR EACH ROW EXECUTE FUNCTION TF_GENERATE_ITEMCODE();
